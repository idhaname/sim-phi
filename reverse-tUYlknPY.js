function e(e){const t=JSON.parse(JSON.stringify(e)),s=[{startTime:-999999,endTime:0,start:t[0]?t[0].start:0,end:t[0]?t[0].start:0,start2:t[0]?t[0].start2:0,end2:t[0]?t[0].start2:0}];t.push({startTime:0,endTime:1e9,start:t[t.length-1]?t[t.length-1].end:0,end:t[t.length-1]?t[t.length-1].end:0,start2:t[t.length-1]?t[t.length-1].end2:0,end2:t[t.length-1]?t[t.length-1].end2:0});for(const e of t){const t=s[s.length-1];e.startTime>e.endTime||t.endTime>e.endTime||(t.endTime===e.startTime?s.push(e):t.endTime<e.startTime?s.push({startTime:t.endTime,endTime:e.startTime,start:t.end,end:t.end,start2:t.end2,end2:t.end2},e):t.endTime>e.startTime&&s.push({startTime:t.endTime,endTime:e.endTime,start:(e.start*(e.endTime-t.endTime)+e.end*(t.endTime-e.startTime))/(e.endTime-e.startTime),end:t.end,start2:(e.start2*(e.endTime-t.endTime)+e.end2*(t.endTime-e.startTime))/(e.endTime-e.startTime),end2:t.end2}))}const n=[s.shift()];for(const e of s){const t=n[n.length-1],s=t.endTime-t.startTime,i=e.endTime-e.startTime;e.startTime===e.endTime||(t.end===e.start&&t.end2===e.start2&&(t.end-t.start)*i==(e.end-e.start)*s&&(t.end2-t.start2)*i==(e.end2-e.start2)*s?(t.endTime=e.endTime,t.end=e.end,t.end2=e.end2):n.push(e))}return JSON.parse(JSON.stringify(n))}class t{constructor(e,t,s,n,i,o){this.startTime=i,this.endTime=o,this.start=e,this.end=t,this.start2=s,this.end2=n}}class s{constructor(e,t,s,n,i){this.type=e,this.time=t,this.positionX=s,this.holdTime=n,this.speed=i,this.floorPosition=0}}class n{constructor(e,t,s){this.startTime=t,this.endTime=s,this.floorPosition=0,this.value=e}}class i{constructor(){this.numOfNotes=0,this.numOfNotesAbove=0,this.numOfNotesBelow=0,this.bpm=120,this.speedEvents=[],this.notesAbove=[],this.notesBelow=[],this.judgeLineDisappearEvents=[],this.judgeLineMoveEvents=[],this.judgeLineRotateEvents=[]}updateSefp(){let e=0;this.speedEvents.sort(((e,t)=>e.startTime-t.startTime));for(const t of this.speedEvents)t.startTime<0&&(t.startTime=0),t.floorPosition=e,e+=(t.endTime-t.startTime)*t.value/this.bpm*1.875;this.speedEvents[this.speedEvents.length-1].endTime=1e9;for(const e of this.notesAbove){let t=0,s=0,n=0;for(const i of this.speedEvents)if(!(e.time%1e9>i.endTime)){if(e.time%1e9<i.startTime)break;t=i.floorPosition,s=i.value,n=e.time%1e9-i.startTime}e.floorPosition=t+s*n/this.bpm*1.875}for(const e of this.notesBelow){let t=0,s=0,n=0;for(const i of this.speedEvents)if(!(e.time%1e9>i.endTime)){if(e.time%1e9<i.startTime)break;t=i.floorPosition,s=i.value,n=e.time%1e9-i.startTime}e.floorPosition=t+s*n/this.bpm*1.875}}updateDe(){this.judgeLineDisappearEvents.sort(((e,t)=>e.startTime-t.startTime)),this.judgeLineMoveEvents.sort(((e,t)=>e.startTime-t.startTime)),this.judgeLineRotateEvents.sort(((e,t)=>e.startTime-t.startTime)),this.judgeLineDisappearEvents=e(this.judgeLineDisappearEvents),this.judgeLineMoveEvents=e(this.judgeLineMoveEvents),this.judgeLineRotateEvents=e(this.judgeLineRotateEvents)}}class o{constructor(){this.formatVersion=3,this.offset=0,this.numOfNotes=0,this.judgeLineList=[]}}let r=null;function a(r,a){const d=new o;d.offset=-r.offset;for(const o of r.judgeLineList){const r=new i,m=a*o.bpm/1.875;r.bpm=o.bpm;for(const e of o.speedEvents)r.speedEvents.push(new n(e.value,m-e.endTime,m-e.startTime));for(const e of o.notesAbove)3===e.type?r.notesAbove.push(new s(e.type,m-e.time,e.positionX,1,e.speed*e.holdTime)):r.notesAbove.push(new s(e.type,m-e.time,e.positionX,e.holdTime,e.speed)),r.numOfNotesAbove++;for(const e of o.notesBelow)3===e.type?r.notesBelow.push(new s(e.type,m-e.time,e.positionX,1,e.speed*e.holdTime)):r.notesBelow.push(new s(e.type,m-e.time,e.positionX,e.holdTime,e.speed)),r.numOfNotesBelow++;r.numOfNotes+=r.numOfNotesAbove+r.numOfNotesBelow,d.numOfNotes+=r.numOfNotes,r.updateSefp(),o.judgeLineDisappearEvents=e(o.judgeLineDisappearEvents),o.judgeLineMoveEvents=e(o.judgeLineMoveEvents),o.judgeLineRotateEvents=e(o.judgeLineRotateEvents);for(const e of o.judgeLineDisappearEvents)r.judgeLineDisappearEvents.push(new t(e.end,e.start,e.end2,e.start2,m-e.endTime,m-e.startTime));for(const e of o.judgeLineMoveEvents)r.judgeLineMoveEvents.push(new t(e.end,e.start,e.end2,e.start2,m-e.endTime,m-e.startTime));for(const e of o.judgeLineRotateEvents)r.judgeLineRotateEvents.push(new t(e.end,e.start,e.end2,e.start2,m-e.endTime,m-e.startTime));r.updateDe(),d.judgeLineList.push(r)}return JSON.parse(JSON.stringify(d))}hook.before.set("kfcFkXqsVw50",(()=>{if(!(r instanceof Map))return;const e=hook.bgms.get(hook.selectbgm.value).audio;if(null!=e)for(let t=0;t<e.numberOfChannels;t++)e.getChannelData(t).reverse();r.set(e,hook.awawa=!r.get(e)),hook.modify=hook.awawa?e=>a(e,hook.app.duration):e=>e})),function(){const e=document.querySelector(".title");if(!(e instanceof HTMLElement))return;let t=NaN;const s=()=>(isNaN(t)&&(t=performance.now()),e.style.cssText+=`;filter:hue-rotate(${(performance.now()-t)/4}deg)`,performance.now()-t>3473&&401*Math.random()<1?1:0);!function(e,t,s,n){let i=null;function o(){i=requestAnimationFrame(o),t()&&(cancelAnimationFrame(i),s(),e.removeEventListener("mousedown",o),e.removeEventListener("mouseup",r),e.removeEventListener("mouseleave",r),e.removeEventListener("touchstart",o),e.removeEventListener("touchend",r),e.removeEventListener("touchcancel",r))}function r(){cancelAnimationFrame(i),n()}e.addEventListener("mousedown",o),e.addEventListener("mouseup",r),e.addEventListener("mouseleave",r),e.addEventListener("touchstart",o,{passive:!0}),e.addEventListener("touchend",r),e.addEventListener("touchcancel",r)}(e,s,(()=>{hook.fireModal("<p>Tip</p>","<p>Reverse Mode is on...</p>"),r=new Map,setInterval(s,20)}),(()=>{e.style.cssText+=";filter:hue-rotate(0deg);",t=NaN}))}();export{a as reverse};
//# sourceMappingURL=reverse-tUYlknPY.js.map
